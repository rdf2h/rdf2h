!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("$rdf"),require("fetch")):"function"==typeof define&&define.amd?define(["$rdf","fetch"],t):"object"==typeof exports?exports.rdf2h=t(require("$rdf"),require("fetch")):e.rdf2h=t(e.$rdf,e.fetch)}(window,(function(e,t){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=4)}([function(t,r){t.exports=e},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n,o=(n=r(0))&&n.__esModule?n:{default:n},i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}(r(3));function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function u(e,t,r){return(u=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var o=new(Function.bind.apply(e,n));return r&&a(o,r.prototype),o}).apply(null,arguments)}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}i.default.Headers||window.Headers;function c(){return u(c.Impl,Array.prototype.slice.call(arguments))}c.Impl=function(){function e(t,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._graph=r,Array.isArray(t)?this.nodes=t:this.nodes=[t],this.sources=n}var t,r,n;return t=e,(r=[{key:"fetch",value:function(){var e=this;if("NamedNode"!==this.termType||this.sources&&this.sources.indexOf(this.value.split("#")[0])>-1)return Promise.resolve(this);var t=this.value.split("#")[0];return c.rdfFetch(t).then((function(e){return e.graph()})).then((function(r){return c(e.node,r,[t])}))}},{key:"each",value:function(e){var t=this,r=this.nodes.map((function(r){return e(c([r],t.graph,t.sources))}));return Promise.all(r)}},{key:"fetchEach",value:function(e){var t=this,r=this.nodes.map((function(r){return c([r],t.graph,t.sources).fetch().then(e)}));return Promise.all(r)}},{key:"split",value:function(){var e=this;return this.nodes.map((function(t){return c([t],e.graph,e.sources)}))}},{key:"out",value:function(e){return c(this.graph.each(this.node,e),this.graph,this.sources)}},{key:"in",value:function(e){return c(this.graph.statementsMatching(void 0,e,this.node).map((function(e){return e.subject})),this.graph,this.sources)}},{key:"graph",get:function(){if(!this._graph)throw Error("Operation not possible as no Graph is available, try fetching first");return this._graph}},{key:"node",get:function(){if(1!==this.nodes.length)throw Error("Operation not possible as this GraphNode is underdetermined");return this.nodes[0]}},{key:"termType",get:function(){return this.node.termType}},{key:"value",get:function(){return this.node.value}}])&&s(t.prototype,r),n&&s(t,n),e}(),c.rdfFetch=o.default.rdfFetch;var f=c;t.default=f},function(e,t,r){var n,o,i,s;
/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */s=function(e){var t=Object.prototype.toString,r=Array.isArray||function(e){return"[object Array]"===t.call(e)};function n(e){return"function"==typeof e}function o(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function i(e,t){return null!=e&&"object"==typeof e&&t in e}var s=RegExp.prototype.test,u=/\S/;function a(e){return!function(e,t){return s.call(e,t)}(u,e)}var c={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},f=/\s*/,p=/\s+/,l=/\s*=/,h=/\s*\}/,d=/#|\^|\/|>|\{|&|=|!/;function v(e){this.string=e,this.tail=e,this.pos=0}function g(e,t){this.view=e,this.cache={".":this.view},this.parent=t}function y(){this.cache={}}v.prototype.eos=function(){return""===this.tail},v.prototype.scan=function(e){var t=this.tail.match(e);if(!t||0!==t.index)return"";var r=t[0];return this.tail=this.tail.substring(r.length),this.pos+=r.length,r},v.prototype.scanUntil=function(e){var t,r=this.tail.search(e);switch(r){case-1:t=this.tail,this.tail="";break;case 0:t="";break;default:t=this.tail.substring(0,r),this.tail=this.tail.substring(r)}return this.pos+=t.length,t},g.prototype.push=function(e){return new g(e,this)},g.prototype.lookup=function(e){var t,r,o,s=this.cache;if(s.hasOwnProperty(e))t=s[e];else{for(var u,a,c,f=this,p=!1;f;){if(e.indexOf(".")>0)for(u=f.view,a=e.split("."),c=0;null!=u&&c<a.length;)c===a.length-1&&(p=i(u,a[c])||(r=u,o=a[c],null!=r&&"object"!=typeof r&&r.hasOwnProperty&&r.hasOwnProperty(o))),u=u[a[c++]];else u=f.view[e],p=i(f.view,e);if(p){t=u;break}f=f.parent}s[e]=t}return n(t)&&(t=t.call(this.view)),t},y.prototype.clearCache=function(){this.cache={}},y.prototype.parse=function(t,n){var i=this.cache,s=t+":"+(n||e.tags).join(":"),u=i[s];return null==u&&(u=i[s]=function(t,n){if(!t)return[];var i,s,u,c=!1,g=[],y=[],w=[],m=!1,b=!1,x="",j=0;function O(){if(m&&!b)for(;w.length;)delete y[w.pop()];else w=[];m=!1,b=!1}function k(e){if("string"==typeof e&&(e=e.split(p,2)),!r(e)||2!==e.length)throw new Error("Invalid tags: "+e);i=new RegExp(o(e[0])+"\\s*"),s=new RegExp("\\s*"+o(e[1])),u=new RegExp("\\s*"+o("}"+e[1]))}k(n||e.tags);for(var P,R,C,_,E,M,T=new v(t);!T.eos();){if(P=T.pos,C=T.scanUntil(i))for(var N=0,S=C.length;N<S;++N)a(_=C.charAt(N))?(w.push(y.length),x+=_):(b=!0,c=!0,x+=" "),y.push(["text",_,P,P+1]),P+=1,"\n"===_&&(O(),x="",j=0,c=!1);if(!T.scan(i))break;if(m=!0,R=T.scan(d)||"name",T.scan(f),"="===R?(C=T.scanUntil(l),T.scan(l),T.scanUntil(s)):"{"===R?(C=T.scanUntil(u),T.scan(h),T.scanUntil(s),R="&"):C=T.scanUntil(s),!T.scan(s))throw new Error("Unclosed tag at "+T.pos);if(E=">"==R?[R,C,P,T.pos,x,j,c]:[R,C,P,T.pos],j++,y.push(E),"#"===R||"^"===R)g.push(E);else if("/"===R){if(!(M=g.pop()))throw new Error('Unopened section "'+C+'" at '+P);if(M[1]!==C)throw new Error('Unclosed section "'+M[1]+'" at '+P)}else"name"===R||"{"===R||"&"===R?b=!0:"="===R&&k(C)}if(O(),M=g.pop())throw new Error('Unclosed section "'+M[1]+'" at '+T.pos);return function(e){for(var t,r=[],n=r,o=[],i=0,s=e.length;i<s;++i)switch((t=e[i])[0]){case"#":case"^":n.push(t),o.push(t),n=t[4]=[];break;case"/":o.pop()[5]=t[2],n=o.length>0?o[o.length-1][4]:r;break;default:n.push(t)}return r}(function(e){for(var t,r,n=[],o=0,i=e.length;o<i;++o)(t=e[o])&&("text"===t[0]&&r&&"text"===r[0]?(r[1]+=t[1],r[3]=t[3]):(n.push(t),r=t));return n}(y))}(t,n)),u},y.prototype.render=function(e,t,r,n){var o=this.parse(e,n),i=t instanceof g?t:new g(t);return this.renderTokens(o,i,r,e,n)},y.prototype.renderTokens=function(e,t,r,n,o){for(var i,s,u,a="",c=0,f=e.length;c<f;++c)u=void 0,"#"===(s=(i=e[c])[0])?u=this.renderSection(i,t,r,n):"^"===s?u=this.renderInverted(i,t,r,n):">"===s?u=this.renderPartial(i,t,r,o):"&"===s?u=this.unescapedValue(i,t):"name"===s?u=this.escapedValue(i,t):"text"===s&&(u=this.rawValue(i)),void 0!==u&&(a+=u);return a},y.prototype.renderSection=function(e,t,o,i){var s=this,u="",a=t.lookup(e[1]);if(a){if(r(a))for(var c=0,f=a.length;c<f;++c)u+=this.renderTokens(e[4],t.push(a[c]),o,i);else if("object"==typeof a||"string"==typeof a||"number"==typeof a)u+=this.renderTokens(e[4],t.push(a),o,i);else if(n(a)){if("string"!=typeof i)throw new Error("Cannot use higher-order sections without the original template");null!=(a=a.call(t.view,i.slice(e[3],e[5]),(function(e){return s.render(e,t,o)})))&&(u+=a)}else u+=this.renderTokens(e[4],t,o,i);return u}},y.prototype.renderInverted=function(e,t,n,o){var i=t.lookup(e[1]);if(!i||r(i)&&0===i.length)return this.renderTokens(e[4],t,n,o)},y.prototype.indentPartial=function(e,t,r){for(var n=t.replace(/[^ \t]/g,""),o=e.split("\n"),i=0;i<o.length;i++)o[i].length&&(i>0||!r)&&(o[i]=n+o[i]);return o.join("\n")},y.prototype.renderPartial=function(e,t,r,o){if(r){var i=n(r)?r(e[1]):r[e[1]];if(null!=i){var s=e[6],u=e[5],a=e[4],c=i;return 0==u&&a&&(c=this.indentPartial(i,a,s)),this.renderTokens(this.parse(c,o),t,r,c)}}},y.prototype.unescapedValue=function(e,t){var r=t.lookup(e[1]);if(null!=r)return r},y.prototype.escapedValue=function(t,r){var n=r.lookup(t[1]);if(null!=n)return e.escape(n)},y.prototype.rawValue=function(e){return e[1]},e.name="mustache.js",e.version="3.1.0",e.tags=["{{","}}"];var w=new y;return e.clearCache=function(){return w.clearCache()},e.parse=function(e,t){return w.parse(e,t)},e.render=function(e,t,n,o){if("string"!=typeof e)throw new TypeError('Invalid template! Template should be a "string" but "'+(r(i=e)?"array":typeof i)+'" was given as the first argument for mustache#render(template, view, partials)');var i;return w.render(e,t,n,o)},e.to_html=function(t,r,o,i){var s=e.render(t,r,o);if(!n(i))return s;i(s)},e.escape=function(e){return String(e).replace(/[&<>"'`=\/]/g,(function(e){return c[e]}))},e.Scanner=v,e.Context=g,e.Writer=y,e},t&&"string"!=typeof t.nodeName?s(t):(o=[t],void 0===(i="function"==typeof(n=s)?n.apply(t,o):n)||(e.exports=i))},function(e,r){e.exports=t},function(e,t,r){"use strict";r.r(t);var n=r(0),o=r.n(n),i=r(1),s=r.n(i),u=r(2);function a(e){return o.a.sym("http://www.w3.org/1999/02/22-rdf-syntax-ns#"+e)}function c(e){return o.a.sym("http://www.w3.org/2000/01/rdf-schema#"+e)}function f(e){return o.a.sym("http://rdf2h.github.io/2015/rdf2h#"+e)}var p;new Array;function l(e,t){Array.isArray(e)||(e=[e]),this.tbox=t||e[0],this.rendererGraphs=e.reverse(),this.env={}}p=u.Context.prototype.lookup,u.Context.prototype.lookup=function(e){if(this.view instanceof l.Renderee){var t=function(e){var t=function(e){var t=[],r=!1,n=!1,o="";function i(){o.length>0&&(t.push(o),o="")}for(var s=0;s<e.length;s++){var u=e[s];n&&("-"!==u&&(i(),r=!0),o+="<",n=!1),"<"!==u?r&&">"==u?(o+=u,i(),r=!1):r||"/"!=u?o+=u:i():n=!0}return i(),t}(e);return function e(t,r){var n,i="."===(n=r[0])?t:n.endsWith("<-")?t.in(l.resolveCurie(n.substring(0,n.length-2))):n.startsWith("^")?t.in(l.resolveCurie(n.substring(1))):t.out(l.resolveCurie(n));if(1===r.length){var s=i.nodes;if(0===s.length){if(t.nodes[0].language&&l.resolveCurie(r[0]).equals(o.a.sym("http://purl.org/dc/terms/language")))return[o.a.literal(t.nodes[0].language)];if(t.nodes[0].datatype&&l.resolveCurie(r[0]).equals(l.resolveCurie("rdf:type")))return[t.nodes[0].datatype]}return s}return e(i,r.slice(1))}(n,t)},r=this.view.rdf2h,n=this.view.graphNode,i=n.graph,u=this.view.context;if(e.startsWith("@prefix ")){var a=(d=e.split(" "))[1],c=d[2],f=a.substring(0,a.length-1),h=c.substring(1,c.length-1);return l.prefixMap[f]=h,""}if(e.startsWith(":render ")){var d,v,g=(d=e.split(" "))[1];(v=d[2])&&(v=l.resolveCurie(v)),v||(v=u);var y=t(g);return y.length>1&&console.warn("Argument of render evaluates to more than one node!"),y.length>0?r.render(i,y[0],v):""}if(e.startsWith(":continue"))return(v=(d=e.split(" "))[1])&&(v=l.resolveCurie(v)),v||(v=u),n.nodes.length>1&&console.warn(":continue invoked in context with more than one node, this shouldn't be possible!"),r.render(i,n.nodes[0],v);if(e.startsWith("+"))return t(e=e.substring(1)).length>0;var w=t(e);return 1===w.length?new l.Renderee(r,s()(w[0],i),u):w.map((function(e){return new l.Renderee(r,s()(e,i),u)}))}return p.call(this,e)},l.Renderee=function(e,t,r){if(!t.nodes)throw new Error("second argument must be a GraphNode");if(1!==t.nodes.length)throw new Error("Renderee must be a single node");this.rdf2h=e,this.graphNode=t,this.context=r},l.Renderee.prototype.toString=function(){return this.graphNode.value?this.graphNode.value:this.graphNode.toString()},l.prototype.getRenderer=function(e){var t=this.tbox;var r=this;var n,i="Literal"===(n=e.graphNode).node.termType?[n.node.datatype]:n.out(a("type")).nodes.sort((function(e,r){return e.equals(r)?0:e.equals(c("Resource"))?1:r.equals(c("Resource"))?-1:0===t.match(e,c("subClassOf"),r).length?0===t.match(r,c("subClassOf"),e).length?e.value.localeCompare(r.value):1:-1})).concat([c("Resource")]),p=function(e,t){var n=r.rendererGraphs;return e.reduce((function(e,r){return e||n.reduce((function(e,n){var o=s()(r,n);return e||o.in(f("type")).split().find((function(e){return t.equals(e.out(f("context")).node)}))}),null)}),null)}(i,e.context);if(!p)throw Error("No renderer found with context: <"+e.context.value+"> for any of the types "+i.map((function(e){return"<"+e.value+">"})).join()+". The resource <"+e.graphNode.value+"> could thus not be rendered.");var l=p.out(f("mustache"));if(l.nodes.length>0)return function(e){return function(t){return Object(u.render)(e,t)}}(l.value);var h=p.out(f("javaScript"));return function(e){try{var t="",r=new Function("n","context","$rdf","render","print","GraphNode","env",h.value)(e.graphNode,e.context,o.a,(function(t,r){return e.rdf2h.render(t.graph,t.node,r||e.context)}),(function(e){t+=e}),s.a,e.rdf2h.env);return r?t+r:t}catch(e){e.message=e.message+" in "+h.value;var n=e.stack.split("\n"),i=n.findIndex((function(e){return e.indexOf("RDF2h.render")>0}));throw e.stack=n.splice(0,i-1).join("\n"),e}}},l.prototype.render=function(e,t,r){t.termType||(t=Object(n.sym)(t)),r||(r=f("Default"));var o=new l.Renderee(this,s()(t,e),r);return this.getRenderer(o)(o)},l.prefixMap={},l.prefixMap.rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#",l.prefixMap.rdfs="http://www.w3.org/2000/01/rdf-schema#",l.prefixMap.r2h="http://rdf2h.github.io/2015/rdf2h#",l.prefixMap.schema="http://schema.org/",l.prefixMap.rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#",l.prefixMap.dct="http://purl.org/dc/terms/",l.resolveCurie=function(e){if(e.startsWith("<")&&e.endsWith(">"))return Object(n.sym)(e.substring(1,e.length-1));var t=e.split(":"),r=t[0],o=t[1];return l.prefixMap[r]?Object(n.sym)(l.prefixMap[r]+o):Object(n.sym)(e)};t.default=l}]).default}));
//# sourceMappingURL=rdf2h.js.map